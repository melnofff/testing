# Лабораторная работа №7: CI/CD пайплайн

## Описание проекта
Автоматизированное тестирование веб-приложения с использованием CI/CD пайплайна в GitVerse.

## Структура проекта
```
lab7_ci-cd/
├── tests/                          # Папка с тестами
│   ├── __init__.py
│   └── test_yandex_form.py        # Тесты формы поиска Яндекс
├── pages/                          # Page Object паттерн
│   ├── __init__.py
│   └── yandex_form_page.py        # Класс страницы Яндекс
├── .gitlab-ci.yml                  # Конфигурация CI/CD пайплайна
├── conftest.py                     # Конфигурация pytest и фикстуры
├── requirements.txt                # Зависимости проекта
└── README.md                       # Этот файл
```

## Технологии
- **Python 3.9+** - язык программирования
- **Selenium** - автоматизация браузера
- **Pytest** - фреймворк для тестирования
- **Allure** - отчеты о тестировании
- **GitVerse** - система контроля версий и CI/CD

## Установка и запуск локально

### 1. Создание виртуального окружения
```bash
python -m venv venv
```

### 2. Активация виртуального окружения

Windows:
```bash
venv\Scripts\activate
```

Linux/Mac:
```bash
source venv/bin/activate
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Запуск тестов
```bash
# Простой запуск
python -m pytest tests/ -v

# С генерацией Allure отчета
python -m pytest tests/ -v --alluredir=allure-results

# Просмотр Allure отчета
allure serve allure-results
```

## Настройка в GitVerse

### Шаг 1: Создание проекта
1. Зарегистрируйтесь на https://gitverse.ru
2. Создайте новый проект "ci-cd-lab-7"
3. Выберите видимость: Публичный

### Шаг 2: Загрузка файлов
Загрузите следующие файлы и папки в GitVerse:
- `tests/` - папка с тестами
- `pages/` - папка с Page Objects
- `.gitlab-ci.yml` - конфигурация CI/CD
- `conftest.py` - конфигурация pytest
- `requirements.txt` - зависимости
- `README.md` - документация

### Шаг 3: Запуск пайплайна
1. После загрузки файлов перейдите в раздел **CI/CD → Пайплайны**
2. Пайплайн запустится автоматически
3. Дождитесь завершения (зеленый статус = успех)

### Шаг 4: Просмотр результатов
1. Откройте завершенный пайплайн
2. Посмотрите логи выполнения тестов
3. Скачайте артефакты (Allure отчеты)

## Описание CI/CD пайплайна

Файл `.gitlab-ci.yml` содержит две стадии:

### Стадия 1: test (run_tests)
- Использует образ `python:3.9`
- Устанавливает Google Chrome и зависимости
- Запускает тесты с pytest
- Генерирует Allure результаты
- Сохраняет артефакты на 1 неделю

### Стадия 2: report (generate_allure_report)
- Генерирует красивый HTML отчет Allure
- Сохраняет отчет как артефакт
- Запускается только после успешного прохождения тестов

## Что тестируется

Проект тестирует функциональность поиска на сайте ya.ru:

1. **test_yandex_search_input** - ввод текста в поисковую строку
   - Параметризованный тест с 3 вариантами запросов
   - Проверка корректности ввода текста

2. **test_suggest_display** - отображение подсказок
   - Проверка появления списка подсказок при вводе

3. **test_search_input_clear** - очистка поисковой строки
   - Проверка функции очистки поля ввода

## Частые проблемы и решения

### Тесты падают в CI/CD
- Убедитесь, что установлен Chrome в `before_script`
- Проверьте, что используется headless режим в `conftest.py`
- Проверьте логи пайплайна для деталей

### Не генерируется Allure отчет
- Убедитесь, что `allure-pytest` установлен в `requirements.txt`
- Проверьте наличие флага `--alluredir=allure-results` в команде pytest

### Пайплайн не запускается автоматически
- Проверьте, что файл `.gitlab-ci.yml` находится в корне проекта
- Убедитесь, что вы делаете push в ветку `main` или `master`

## Требования для сдачи

### Обязательно:
1. Ссылка на проект в GitVerse
2. Скриншоты:
   - Главная страница проекта
   - Успешный пайплайн (зеленый статус)
   - Логи выполнения тестов

### Дополнительно (для +баллов):
1. Ссылка на Allure отчет
2. Скриншот уведомления о запуске пайплайна
3. Настройка запуска на любых ветках

## Автор: Danila Melnikov
Лабораторная работа №7 по дисциплине "Тестирование программного обеспечения"

## Полезные ссылки
- [GitVerse](https://gitverse.ru)
- [Документация Selenium](https://www.selenium.dev/documentation/)
- [Документация Pytest](https://docs.pytest.org/)
- [Документация Allure](https://docs.qameta.io/allure/)
